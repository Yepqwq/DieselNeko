import{defineAsyncComponent as M,ref as L,defineComponent as k,h as m,resolveComponent as h,openBlock as p,createBlock as V,createSlots as S,withCtx as a,createVNode as u,createElementVNode as l,toDisplayString as d,renderSlot as z,createTextVNode as c,provide as D,computed as A,unref as C,createElementBlock as y,createCommentVNode as F,Fragment as I}from"../vue.js";import{store as i,icons as b}from"../client.js";const N=M(()=>import("./echarts-c18796a0.mjs")),g=L("send");function H({title:e,fields:n,showTab:s,options:t}){return k({render:()=>{if(!n.every(r=>i[r]))return null;const o=t(i,g.value);if(o)return m(h("k-card"),{class:"frameless analytic-chart"},{header:()=>[m("span",{class:"left"},[e]),...s?[m("span",{class:"right"},[m("span",{class:"tab-item"+(g.value==="send"?" active":""),onClick:()=>g.value="send"},["\u53D1\u9001"]),m("span",{class:"tab-item"+(g.value==="receive"?" active":""),onClick:()=>g.value="receive"},["\u63A5\u6536"])])]:[]],default:()=>m(N,{option:o,autoresize:true})})}})}var f;(e=>{e.item=n=>({trigger:"item",formatter:n}),e.axis=n=>({trigger:"axis",axisPointer:{type:"cross"},formatter:n})})(f||(f={}));const j=e=>{e.slot({type:"analytic-chart",component:H({title:"\u6307\u4EE4\u8C03\u7528\u9891\u7387",fields:["analytics"],options({analytics:n}){const s=Object.entries(n.commandRate).sort((t,o)=>o[1]-t[1]).map(([t,o])=>({name:t,value:o}));if(s.length)return{tooltip:f.item(({data:t})=>{const o=[t.name];return o.push(`\u65E5\u5747\u8C03\u7528\uFF1A${+t.value.toFixed(1)}`),o.join("<br>")}),series:[{type:"pie",data:s,radius:["35%","65%"],minShowLabelAngle:3}]}}})})},O=e=>{e.slot({type:"analytic-chart",component:H({title:"\u5404\u5E73\u53F0\u6D88\u606F\u5360\u6BD4",fields:["analytics"],showTab:true,options({analytics:n},s){const t=Object.entries(n.messageByBot).map(([r,_])=>({name:r,children:Object.entries(_).map(([x,$])=>({name:$.name||x,value:$[s]}))}));if(t.reduce((r,{children:_})=>r+_.reduce((x,{value:$})=>x+$,0),0))return{tooltip:f.item(({data:r})=>`${r.children?"\u5E73\u53F0":"\u6635\u79F0"}\uFF1A${r.name}<br>\u65E5\u5747\u6D88\u606F\u6570\u91CF\uFF1A${+r.value.toFixed(1)}`),series:[{type:"sunburst",data:t,radius:["0","65%"],nodeClick:false,emphasis:{focus:"ancestor"},levels:[{},{label:{rotate:"tangential"}},{label:{position:"outside",padding:3,silent:false}}]}]}}})})},T="\u65E5\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D",U=e=>{e.slot({type:"analytic-chart",component:H({title:"\u5386\u53F2\u6D88\u606F\u6570\u91CF",fields:["analytics"],showTab:true,options({analytics:n},s){if(!n.messageByDate.length)return;const t=n.messageByDate.slice(1);return{tooltip:f.axis(([{name:o,value:r}])=>{const _=new Date(o).getDay();return`${o} \u661F\u671F${T[_]}<br>\u6D88\u606F\u6570\u91CF\uFF1A${r}`}),xAxis:{type:"category",data:t.map((o,r)=>new Date(Date.now()-(r+1)*864e5).toLocaleDateString("zh-CN")).reverse()},yAxis:{type:"value"},series:{type:"line",smooth:true,data:t.map(o=>o[s]).reverse()}}}})})},B=e=>`${(e-.5).toFixed()}:00-${(e+.5).toFixed()}:00`,E=e=>{e.slot({type:"analytic-chart",component:H({title:"\u6BCF\u5C0F\u65F6\u6D88\u606F\u6570\u91CF",fields:["analytics"],showTab:true,options({analytics:n},s){if(!n.messageByHour.every(t=>!t[s]))return{tooltip:f.axis(t=>{const[{data:[o],dataIndex:r}]=t,_=n.messageByHour[r];return[`${B(o)}`,`\u65E5\u5747\u6D88\u606F\u6570\u91CF\uFF1A${+(_[s]||0).toFixed(1)}`].join("<br>")}),xAxis:{type:"value",min:0,max:24,minInterval:1,maxInterval:4,axisLabel:{formatter:t=>t+":00"},axisPointer:{label:{formatter:({value:t})=>B(t)}}},yAxis:{type:"value"},series:[{data:n.messageByHour.map((t,o)=>[o+.5,t[s]||0]),type:"bar",stack:"1"}]}}})})},G=e=>{e.plugin(U),e.plugin(E),e.plugin(O),e.plugin(j)},P={class:"content"},R={class:"title"},q={class:"value"},J={class:"left"},K={class:"right"},w=k({__name:"numeric",props:{title:{},icon:{}},setup(e){return(n,s)=>{const t=h("k-icon"),o=h("k-card");return p(),V(o,{class:"k-analytic-number"},S({default:a(()=>[u(t,{name:n.icon},null,8,["name"]),l("div",P,[l("p",R,d(n.title),1),l("p",q,[z(n.$slots,"default",{},()=>[c("-")])])])]),_:2},[n.$slots["footer-left"]?{name:"footer",fn:a(()=>[l("span",J,[z(n.$slots,"footer-left")]),l("span",K,[z(n.$slots,"footer-right",{},()=>[c("-")])])]),key:"0"}:void 0]),1024)}}});const Q={key:0,class:"card-grid numeric-grid"},W=k({__name:"index",setup(e){D("component:analytic-number",w);const n=A(()=>{const s=i.analytics.dauHistory.slice(1),t=i.analytics.dauHistory.length-1;return t?s.reduce((o,r)=>o+r,0)/Math.min(s.length,t):0});return(s,t)=>{const o=h("k-slot-item"),r=h("k-slot");return C(i).analytics?(p(),y("div",Q,[u(r,{name:"analytic-number"},{default:a(()=>[u(o,null,{default:a(()=>[u(w,{icon:"analytic:user",title:"\u7528\u6237\u6570\u91CF"},{default:a(()=>[c(d(C(i).analytics.userCount),1)]),"footer-left":a(()=>[c("\u6628\u65E5\u65B0\u589E\u7528\u6237")]),"footer-right":a(()=>[c(d(C(i).analytics.userIncrement),1)]),_:1}),u(w,{icon:"analytic:guild",title:"\u7FA4\u7EC4\u6570\u91CF"},{default:a(()=>[c(d(C(i).analytics.guildCount),1)]),"footer-left":a(()=>[c("\u6628\u65E5\u65B0\u589E\u7FA4\u7EC4")]),"footer-right":a(()=>[c(d(C(i).analytics.guildIncrement),1)]),_:1}),u(w,{icon:"analytic:heart",title:"\u4ECA\u65E5 DAU"},{default:a(()=>[c(d(C(i).analytics.dauHistory[0]),1)]),"footer-left":a(()=>[c("\u8FD1\u671F DAU")]),"footer-right":a(()=>[c(d(+n.value.toFixed(1)),1)]),_:1})]),_:1})]),_:1})])):F("v-if",true)}}});const v=(e,n)=>{const s=e.__vccOpts||e;for(const[t,o]of n)s[t]=o;return s},X=v(W,[["__scopeId","data-v-13f04675"]]),Y={class:"card-grid chart-grid"},Z=k({__name:"home",setup(e){return(n,s)=>{const t=h("k-slot");return p(),y(I,null,[u(X),l("div",Y,[u(t,{name:"analytic-chart"})])],64)}}});const tt={},et={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"},nt=l("path",{fill:"currentColor",d:"M274.7 304H173.3c-95.73 0-173.3 77.6-173.3 173.3C0 496.5 15.52 512 34.66 512H413.3C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM413.3 480H34.66C33.2 480 32 478.8 32 477.3C32 399.4 95.4 336 173.3 336H274.7C352.6 336 416 399.4 416 477.3C416 478.8 414.8 480 413.3 480zM224 256c70.7 0 128-57.31 128-128S294.7 0 224 0C153.3 0 96 57.31 96 128S153.3 256 224 256zM224 32c52.94 0 96 43.06 96 96c0 52.93-43.06 96-96 96S128 180.9 128 128C128 75.06 171.1 32 224 32zM375.1 241C392.9 250.8 412.3 256 432 256C493.8 256 544 205.8 544 144S493.8 32 432 32c-12.83 0-25.39 2.156-37.34 6.391c-8.328 2.953-12.69 12.09-9.734 20.42c2.953 8.344 12.12 12.66 20.42 9.734C413.9 65.53 422.8 64 432 64C476.1 64 512 99.89 512 144S476.1 224 432 224c-14.08 0-27.91-3.703-39.98-10.69c-7.656-4.453-17.44-1.828-21.86 5.828C365.7 226.8 368.3 236.6 375.1 241zM490.7 320H448c-8.844 0-16 7.156-16 16S439.2 352 448 352h42.67C555.4 352 608 404.6 608 469.3C608 475.2 603.2 480 597.3 480H496c-8.844 0-16 7.156-16 16s7.156 16 16 16h101.3C620.9 512 640 492.9 640 469.3C640 386.1 573 320 490.7 320z"},null,-1),ot=[nt];function st(e,n){return p(),y("svg",et,ot)}const rt=v(tt,[["render",st]]),at={},ct={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},it=l("path",{fill:"currentColor",d:"M255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84.02L255.1 96zM255.1 141.3L221.4 106.6C196.1 81.31 160 69.77 124.7 75.66C71.21 84.58 31.1 130.9 31.1 185.1V190.9C31.1 223.6 45.55 254.7 69.42 277L250.1 445.7C251.7 447.2 253.8 448 255.1 448C258.2 448 260.3 447.2 261.9 445.7L442.6 277C466.4 254.7 480 223.6 480 190.9V185.1C480 130.9 440.8 84.58 387.3 75.66C351.1 69.77 315.9 81.31 290.6 106.6L255.1 141.3z"},null,-1),lt=[it];function ut(e,n){return p(),y("svg",ct,lt)}const _t=v(at,[["render",ut]]),dt={},pt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},mt=l("path",{fill:"currentColor",d:"M256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C172.2 512 97.87 471.8 51.19 409.6C45.88 402.5 47.31 392.5 54.37 387.2C61.44 381.9 71.47 383.3 76.78 390.4C117.7 444.8 182.7 480 256 480C379.7 480 480 379.7 480 256C480 132.3 379.7 32 256 32C166.7 32 89.51 84.3 53.55 160H144C152.8 160 160 167.2 160 176C160 184.8 152.8 192 144 192H16C7.164 192 0 184.8 0 176V48C0 39.16 7.164 32 16 32C24.84 32 32 39.16 32 48V131.1C75.66 53.29 159.6 0 256 0zM256 128C264.8 128 272 135.2 272 144V249.4L347.3 324.7C353.6 330.9 353.6 341.1 347.3 347.3C341.1 353.6 330.9 353.6 324.7 347.3L244.7 267.3C241.7 264.3 239.1 260.2 239.1 256V144C239.1 135.2 247.2 128 255.1 128H256z"},null,-1),Ct=[mt];function ht(e,n){return p(),y("svg",pt,Ct)}const ft=v(dt,[["render",ht]]),yt={},gt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},vt=l("path",{fill:"currentColor",d:"M224 256c70.7 0 128-57.31 128-128s-57.3-128-128-128C153.3 0 96 57.31 96 128S153.3 256 224 256zM224 32c52.94 0 96 43.06 96 96c0 52.93-43.06 96-96 96S128 180.9 128 128C128 75.06 171.1 32 224 32zM274.7 304H173.3C77.61 304 0 381.6 0 477.3c0 19.14 15.52 34.67 34.66 34.67h378.7C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM413.3 480H34.66C33.2 480 32 478.8 32 477.3C32 399.4 95.4 336 173.3 336h101.3C352.6 336 416 399.4 416 477.3C416 478.8 414.8 480 413.3 480z"},null,-1),xt=[vt];function $t(e,n){return p(),y("svg",gt,xt)}const wt=v(yt,[["render",$t]]);b.register("analytic:guild",rt);b.register("analytic:heart",_t);b.register("analytic:history",ft);b.register("analytic:user",wt);const Ht=e=>{e.plugin(G),e.slot({type:"home",component:Z,order:0})};export{Ht as default};
