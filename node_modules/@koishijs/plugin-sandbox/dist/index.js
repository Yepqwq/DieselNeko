import{defineComponent as Ae,computed as ye,openBlock as R,createElementBlock as W,createElementVNode as I,withKeys as Ye,withModifiers as Re,h as E,toDisplayString as ne,unref as z,createVNode as K,createCommentVNode as xe,ref as ce,watch as De,resolveComponent as Q,createBlock as pe,withCtx as X,Fragment as Be,renderList as Ge,normalizeClass as Je,KeepAlive as Ze}from"vue";import{useStorage as qe,receive as $e,send as ee,useMenu as Qe,useContext as Xe,Schema as Me,clone as Ne,deepEqual as et,VirtualList as tt,message as nt,icons as rt}from"@koishijs/client";import{useEventListener as Le}from"@vueuse/core";var st=Object.defineProperty,x=(e,i)=>st(e,"name",{value:i,configurable:true});function at(){}x(at,"noop");function F(e){return e==null}x(F,"isNullable");function it(e){return e&&typeof e=="object"&&!Array.isArray(e)}x(it,"isPlainObject");function ot(e,i){return Object.fromEntries(Object.entries(e).filter(([o,d])=>i(o,d)))}x(ot,"filterKeys");function Ue(e,i){return Object.fromEntries(Object.entries(e).map(([o,d])=>[o,i(d,o)]))}x(Ue,"mapValues");function lt(e,i,o){if(!i)return{...e};const d={};for(const c of i)(o||e[c]!==void 0)&&(d[c]=e[c]);return d}x(lt,"pick");function ut(e,i){if(!i)return{...e};const o={...e};for(const d of i)Reflect.deleteProperty(o,d);return o}x(ut,"omit");function ge(e,i,o){return Object.defineProperty(e,i,{writable:true,value:o,enumerable:false})}x(ge,"defineProperty");function ft(e,i){return i.every(o=>e.includes(o))}x(ft,"contain");function ct(e,i){return e.filter(o=>i.includes(o))}x(ct,"intersection");function pt(e,i){return e.filter(o=>!i.includes(o))}x(pt,"difference");function dt(e,i){return Array.from(new Set([...e,...i]))}x(dt,"union");function gt(e){return[...new Set(e)]}x(gt,"deduplicate");function ht(e,i){const o=e.indexOf(i);return o>=0?(e.splice(o,1),true):false}x(ht,"remove");function Oe(e){return Array.isArray(e)?e:F(e)?[]:[e]}x(Oe,"makeArray");function T(e,i){return arguments.length===1?o=>T(e,o):e in globalThis&&i instanceof globalThis[e]||Object.prototype.toString.call(i).slice(8,-1)===e}x(T,"is");function he(e){return T("ArrayBuffer",e)||T("SharedArrayBuffer",e)}x(he,"isArrayBufferLike");function Te(e){return he(e)||ArrayBuffer.isView(e)}x(Te,"isArrayBufferSource");var re;(e=>{e.is=he,e.isSource=Te;function i(_){return ArrayBuffer.isView(_)?_.buffer.slice(_.byteOffset,_.byteOffset+_.byteLength):_}e.fromSource=i,x(i,"fromSource");function o(_){if(typeof Buffer<"u")return Buffer.from(_).toString("base64");let s="";const u=new Uint8Array(_);for(let p=0;p<u.byteLength;p++)s+=String.fromCharCode(u[p]);return btoa(s)}e.toBase64=o,x(o,"toBase64");function d(_){return typeof Buffer<"u"?i(Buffer.from(_,"base64")):Uint8Array.from(atob(_),s=>s.charCodeAt(0))}e.fromBase64=d,x(d,"fromBase64");function c(_){return typeof Buffer<"u"?Buffer.from(_).toString("hex"):Array.from(new Uint8Array(_),s=>s.toString(16).padStart(2,"0")).join("")}e.toHex=c,x(c,"toHex");function O(_){if(typeof Buffer<"u")return i(Buffer.from(_,"hex"));const s=_.length%2===0?_:_.slice(0,_.length-1),u=[];for(let p=0;p<s.length;p+=2)u.push(parseInt(`${s[p]}${s[p+1]}`,16));return Uint8Array.from(u).buffer}e.fromHex=O,x(O,"fromHex")})(re||(re={}));re.fromBase64;var we=re.toBase64;re.fromHex;re.toHex;function Se(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(Se):T("Date",e)?new Date(e.valueOf()):T("RegExp",e)?new RegExp(e.source,e.flags):he(e)?e.slice(0):ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):Ue(e,Se)}x(Se,"clone");function ke(e,i,o){if(e===i||!o&&F(e)&&F(i))return true;if(typeof e!=typeof i||typeof e!="object"||!e||!i)return false;function d(c,O){return c(e)?c(i)?O(e,i):false:c(i)?false:void 0}return x(d,"check"),d(Array.isArray,(c,O)=>c.length===O.length&&c.every((_,s)=>ke(_,O[s])))??d(T("Date"),(c,O)=>c.valueOf()===O.valueOf())??d(T("RegExp"),(c,O)=>c.source===O.source&&c.flags===O.flags)??d(he,(c,O)=>{if(c.byteLength!==O.byteLength)return false;const _=new Uint8Array(c),s=new Uint8Array(O);for(let u=0;u<_.length;u++)if(_[u]!==s[u])return false;return true})??Object.keys({...e,...i}).every(c=>ke(e[c],i[c],o))}x(ke,"deepEqual");function mt(e){return e.charAt(0).toUpperCase()+e.slice(1)}x(mt,"capitalize");function je(e){return e.charAt(0).toLowerCase()+e.slice(1)}x(je,"uncapitalize");function Pe(e){return e.replace(/[_-][a-z]/g,i=>i.slice(1).toUpperCase())}x(Pe,"camelCase");function He(e){return je(e).replace(/_/g,"-").replace(/.[A-Z]+/g,i=>i[0]+"-"+i.slice(1).toLowerCase())}x(He,"paramCase");function yt(e){return je(e).replace(/-/g,"_").replace(/.[A-Z]+/g,i=>i[0]+"_"+i.slice(1).toLowerCase())}x(yt,"snakeCase");var Ee=Pe,Ke=He;function We(e){return e.replace(/\/$/,"")}x(We,"trimSlash");function vt(e){return e.startsWith("/")||(e="/"+e),We(e)}x(vt,"sanitize");var Fe;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let i=new Date().getTimezoneOffset();function o(g){i=g}e.setTimezoneOffset=o,x(o,"setTimezoneOffset");function d(){return i}e.getTimezoneOffset=d,x(d,"getTimezoneOffset");function c(g=new Date,h){return typeof g=="number"&&(g=new Date(g)),h===void 0&&(h=i),Math.floor((g.valueOf()/e.minute-h)/1440)}e.getDateNumber=c,x(c,"getDateNumber");function O(g,h){const b=new Date(g*e.day);return h===void 0&&(h=i),new Date(+b+h*e.minute)}e.fromDateNumber=O,x(O,"fromDateNumber");const _=/\d+(?:\.\d+)?/.source,s=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(g=>`(${_}${g})?`).join("")}$`);function u(g){const h=s.exec(g);return h?(parseFloat(h[1])*e.week||0)+(parseFloat(h[2])*e.day||0)+(parseFloat(h[3])*e.hour||0)+(parseFloat(h[4])*e.minute||0)+(parseFloat(h[5])*e.second||0):0}e.parseTime=u,x(u,"parseTime");function p(g){const h=u(g);return h?g=Date.now()+h:/^\d{1,2}(:\d{1,2}){1,2}$/.test(g)?g=`${new Date().toLocaleDateString()}-${g}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(g)&&(g=`${new Date().getFullYear()}-${g}`),g?new Date(g):new Date}e.parseDate=p,x(p,"parseDate");function k(g){const h=Math.abs(g);return h>=e.day-e.hour/2?Math.round(g/e.day)+"d":h>=e.hour-e.minute/2?Math.round(g/e.hour)+"h":h>=e.minute-e.second/2?Math.round(g/e.minute)+"m":h>=e.second?Math.round(g/e.second)+"s":g+"ms"}e.format=k,x(k,"format");function w(g,h=2){return g.toString().padStart(h,"0")}e.toDigits=w,x(w,"toDigits");function A(g,h=new Date){return g.replace("yyyy",h.getFullYear().toString()).replace("yy",h.getFullYear().toString().slice(2)).replace("MM",w(h.getMonth()+1)).replace("dd",w(h.getDate())).replace("hh",w(h.getHours())).replace("mm",w(h.getMinutes())).replace("ss",w(h.getSeconds())).replace("SSS",w(h.getMilliseconds(),3))}e.template=A,x(A,"template")})(Fe||(Fe={}));var _t=Object.defineProperty,bt=Object.getOwnPropertyNames,D=(e,i)=>_t(e,"name",{value:i,configurable:true}),xt=(e,i)=>function(){return i||(0,e[bt(e)[0]])((i={exports:{}}).exports,i),i.exports},wt=xt({"satori/packages/element/src/index.ts"(e,i){var _;var o=Symbol.for("satori.element"),d=(_=class{get data(){return this.attrs}getTagName(){var u;return this.type==="component"?((u=this.attrs.is)==null?void 0:u.name)??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([u,p])=>F(p)?"":(u=Ke(u),p===true?` ${u}`:p===false?` no-${u}`:` ${u}="${c.escape(""+p,true)}"`)).join("")}toString(u=false){if(this.type==="text"&&"content"in this.attrs)return u?this.attrs.content:c.escape(this.attrs.content);const p=this.children.map(A=>A.toString(u)).join("");if(u)return p;const k=this.toAttrString(),w=this.getTagName();return this.children.length?`<${w}${k}>${p}</${w}>`:`<${w}${k}/>`}},D(_,"ElementConstructor"),_);ge(d,"name","Element"),ge(d.prototype,o,true);function c(s,...u){const p=Object.create(d.prototype),k={},w=[];if(u[0]&&typeof u[0]=="object"&&!c.isElement(u[0])&&!Array.isArray(u[0])){const A=u.shift();for(const[g,h]of Object.entries(A))F(h)||(g==="children"?u.push(...Oe(h)):k[Ee(g)]=h)}for(const A of u)w.push(...c.toElementArray(A));return typeof s=="function"&&(k.is=s,s="component"),Object.assign(p,{type:s,attrs:k,children:w})}D(c,"Element");var O=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(s=>{s.jsx=s,s.jsxs=s,s.jsxDEV=s,s.Fragment="template";function u(n){return n&&typeof n=="object"&&n[o]}s.isElement=u,D(u,"isElement");function p(n){if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"){if(n=""+n,n)return s("text",{content:n})}else{if(u(n))return n;if(!F(n))throw new TypeError(`Invalid content: ${n}`)}}s.toElement=p,D(p,"toElement");function k(n){return Array.isArray(n)?n.map(p).filter(t=>t):[p(n)].filter(t=>t)}s.toElementArray=k,D(k,"toElementArray");function w(n,t){return typeof n=="string"?$(n,t):k(n)}s.normalize=w,D(w,"normalize");function A(n,t=false){const r=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t?r.replace(/"/g,"&quot;"):r}s.escape=A,D(A,"escape");function g(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(t,r)=>r==="38"?t:String.fromCharCode(+r)).replace(/&#x([0-9a-f]+);/gi,(t,r)=>r==="26"?t:String.fromCharCode(parseInt(r,16))).replace(/&(amp|#38|#x26);/g,"&")}s.unescape=g,D(g,"unescape");function h(n,t={}){var a;const r=$(n);return t.caret?t.type&&((a=r[0])==null?void 0:a.type)!==t.type?void 0:r[0]:N(r,t.type||"*")[0]}s.from=h,D(h,"from");const b=/ *([ >+~]) */g;function j(n){return n.split(",").map(t=>{const r=[];t=t.trim();let a,f=" ";for(;a=b.exec(t);)r.push({type:t.slice(0,a.index),combinator:f}),f=a[1],t=t.slice(a.index+a[0].length);return r.push({type:t,combinator:f}),r})}s.parseSelector=j,D(j,"parseSelector");function N(n,t){if(!n||!t)return[];if(typeof n=="string"&&(n=$(n)),typeof t=="string"&&(t=j(t)),!t.length)return[];let r=[];const a=[];for(const[f,l]of n.entries()){const m=[],C=[...t,...r];r=[];let v=false;for(const y of C){const{type:M,combinator:q}=y[0];(M===l.type||M==="*")&&(y.length===1?v=true:[" ",">"].includes(y[1].combinator)?m.push(y.slice(1)):y[1].combinator==="+"?r.push(y.slice(1)):t.push(y.slice(1))),q===" "&&m.push(y)}v&&a.push(n[f]),a.push(...N(l.children,m))}return a}s.select=N,D(N,"select");function L(n,t){if(n=n.trim(),!/^[\w.]+$/.test(n))return O(n,t)??"";let r=t;for(const a of n.split("."))if(r=r[a],F(r))return"";return r??""}s.interpolate=L,D(L,"interpolate");const se=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,ae=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,ie=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,oe=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=(?<curly>\{([^}]+)\}))?/g;let Y;(n=>{n[n.OPEN=0]="OPEN",n[n.CLOSE=1]="CLOSE",n[n.EMPTY=2]="EMPTY",n[n.CONTINUE=3]="CONTINUE"})(Y||(Y={}));function $(n,t){const r=[];function a(v){v&&r.push(v)}D(a,"pushText");const f=t?ae:se;let l,m=true;for(;l=f.exec(n);){const v=!l.groups.curly;C(n.slice(0,l.index),m,v),m=v,n=n.slice(l.index+l[0].length);const[y,,,M,q,_e,be]=l;if(!l.groups.comment){if(l.groups.curly){let ue="",fe=2;l.groups.derivative&&(ue=l.groups.derivative.slice(1),fe={"@":2,"#":0,"/":1,":":3}[l.groups.derivative[0]]),r.push({type:"curly",name:ue,position:fe,source:l.groups.curly,extra:l.groups.curly.slice(1+(l.groups.derivative??"").length,-1)});continue}r.push({type:"angle",source:y,name:q||s.Fragment,position:M?1:be?2:0,extra:_e})}}C(n,m,true);function C(v,y,M){v=g(v),y&&(v=v.replace(/^\s*\n\s*/,"")),M&&(v=v.replace(/\s*\n\s*$/,"")),a(v)}return D(C,"parseContent"),V(H(r),t)}s.parse=$,D($,"parse");function H(n){const t=[[{type:"angle",name:s.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function r(...a){const[f,l]=t[0];f.children[l].push(...a)}D(r,"pushToken");for(const a of n){if(typeof a=="string"){r(a);continue}const{name:f,position:l}=a;l===1?t[0][0].name===f&&t.shift():l===3?(t[0][0].children[f]=[],t[0][1]=f):l===0?(r(a),a.children={default:[]},t.unshift([a,"default"])):r(a)}return t[t.length-1][0].children.default}D(H,"foldTokens");function V(n,t){const r=[];for(const a of n)if(typeof a=="string")r.push(s("text",{content:a}));else if(a.type==="angle"){const f={},l=t?oe:ie;let m;for(;m=l.exec(a.extra);){const[,C,v,y=v,M]=m;M?f[C]=L(M,t):F(y)?C.startsWith("no-")?f[C.slice(3)]=false:f[C]=true:f[C]=g(y)}r.push(s(a.name,f,a.children&&V(a.children.default,t)))}else if(!a.name)r.push(...k(L(a.extra,t)));else if(a.name==="if")O(a.extra,t)?r.push(...V(a.children.default,t)):r.push(...V(a.children.else||[],t));else if(a.name==="each"){const[f,l]=a.extra.split(/\s+as\s+/),m=L(f,t);if(!m||!m[Symbol.iterator])continue;for(const C of m)r.push(...V(a.children.default,{...t,[l]:C}))}return r}D(V,"parseTokens");function G(n,t,r){const{type:a,attrs:f,children:l}=n;if(typeof t=="function")return t(n,r);{let m=t[typeof a=="string"?a:""]??t.default??true;return typeof m=="function"&&(m=m(f,l,r)),m}}D(G,"visit");function J(n,t,r){const a=typeof n=="string"?$(n):n,f=[];return a.forEach(l=>{const{type:m,attrs:C,children:v}=l,y=G(l,t,r);y===true?f.push(s(m,C,J(v,t,r))):y!==false&&f.push(...k(y))}),typeof n=="string"?f.join(""):f}s.transform=J,D(J,"transform");async function Z(n,t,r){const a=typeof n=="string"?$(n):n,f=(await Promise.all(a.map(async l=>{const{type:m,attrs:C,children:v}=l,y=await G(l,t,r);return y===true?[s(m,C,await Z(v,t,r))]:y!==false?k(y):[]}))).flat(1);return typeof n=="string"?f.join(""):f}s.transformAsync=Z,D(Z,"transformAsync");function P(n,...t){return(...r)=>{const a=s(n);return t.forEach((f,l)=>{F(r[l])||(a.attrs[f]=r[l])}),r[t.length]&&Object.assign(a.attrs,r[t.length]),a}}D(P,"createFactory"),s.warn=D(()=>{},"warn");function U(n){return(t,...r)=>{let a="base64://";return typeof r[0]=="string"&&(a=`data:${r.shift()};base64,`),T("Buffer",t)?t=a+t.toString("base64"):T("ArrayBuffer",t)&&(t=a+we(t)),t.startsWith("base64://")&&(0,s.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),s(n,{...r[0],url:t})}}D(U,"createAssetFactory"),s.text=P("text","content"),s.at=P("at","id"),s.sharp=P("sharp","id"),s.quote=P("quote","id"),s.image=U("image"),s.video=U("video"),s.audio=U("audio"),s.file=U("file");function le(n,t){return s("i18n",typeof n=="string"?{path:n}:n,t)}s.i18n=le,D(le,"i18n")})(c||(c={})),i.exports=c}});const Ce=wt(),St={class:"textarea"},kt=["value","placeholder","onKeydown"],Ct=Ae({__name:"input",props:{target:{default:()=>document},modelValue:{default:""},placeholder:{}},emits:["send","update:modelValue"],setup(e,{emit:i}){const o=i,d=e,c=ye({get:()=>d.modelValue,set:p=>o("update:modelValue",p)});function O(){c.value&&(o("send",Ce.escape(c.value)),c.value="")}function _(p){c.value=p.target.value}function s(p,k){if(k)for(const w of k.items){if(w.kind!=="file")continue;const A=w.getAsFile();if(!A)continue;p.preventDefault();const[g]=A.type.split("/",1);if(!["image","audio","video"].includes(g)){console.warn("Unsupported file type:",A.type);return}const h=new FileReader;h.addEventListener("load",function(){o("send",Ce(g,{src:h.result}).toString())},false),h.readAsDataURL(A)}}Le(d.target,"drop",p=>{s(p,p.dataTransfer)}),Le(d.target,"dragover",p=>{p.preventDefault()});async function u(p){s(p,p.clipboardData)}return(p,k)=>(R(),W("div",St,[I("input",{autocomplete:"off",step:"any",value:c.value,placeholder:p.placeholder,onInput:_,onPaste:u,onKeydown:Ye(Re(O,["stop"]),["enter"])},null,40,kt)]))}});const ve=(e,i)=>{const o=e.__vccOpts||e;for(const[d,c]of i)o[d]=c;return o},At=ve(Ct,[["__scopeId","data-v-76646135"]]),$t=["b","strong","i","em","u","ins","s","del","code"],de=(e,i)=>e.map(({type:o,attrs:d,children:c})=>o==="text"?d.content:o==="at"?E("span",`@${d.name}`):o==="img"?E("img",{src:d.src}):o==="audio"?E("audio",{src:d.src,controls:true}):o==="video"?E("video",{src:d.src,controls:true}):$t.includes(o)?E(o,de(c)):o==="spl"?E("span",{class:"spoiler"},de(c)):o==="p"||o==="message"?E("p",de(c)):o==="iframe"?E("iframe",{innerHTML:d.content}):de(c)),Ot={name:"message-content",props:{content:{type:String,required:true}},setup(e,i){return()=>E("div",{class:"message-content"},de(Ce.parse(e.content)))}};const ze=ve(Ot,[["__scopeId","data-v-a543d36c"]]);var jt=Object.defineProperty,Dt=Object.getOwnPropertyNames,B=(e,i)=>jt(e,"name",{value:i,configurable:true}),Bt=(e,i)=>function(){return i||(0,e[Dt(e)[0]])((i={exports:{}}).exports,i),i.exports},Mt=Bt({"src/index.ts"(e,i){var _;var o=Symbol.for("satori.element"),d=(_=class{get data(){return this.attrs}getTagName(){var u;return this.type==="component"?((u=this.attrs.is)==null?void 0:u.name)??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([u,p])=>F(p)?"":(u=Ke(u),p===true?` ${u}`:p===false?` no-${u}`:` ${u}="${c.escape(""+p,true)}"`)).join("")}toString(u=false){if(this.type==="text"&&"content"in this.attrs)return u?this.attrs.content:c.escape(this.attrs.content);const p=this.children.map(A=>A.toString(u)).join("");if(u)return p;const k=this.toAttrString(),w=this.getTagName();return this.children.length?`<${w}${k}>${p}</${w}>`:`<${w}${k}/>`}},B(_,"ElementConstructor"),_);ge(d,"name","Element"),ge(d.prototype,o,true);function c(s,...u){const p=Object.create(d.prototype),k={},w=[];if(u[0]&&typeof u[0]=="object"&&!c.isElement(u[0])&&!Array.isArray(u[0])){const A=u.shift();for(const[g,h]of Object.entries(A))F(h)||(g==="children"?u.push(...Oe(h)):k[Ee(g)]=h)}for(const A of u)w.push(...c.toElementArray(A));return typeof s=="function"&&(k.is=s,s="component"),Object.assign(p,{type:s,attrs:k,children:w})}B(c,"Element");var O=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(s=>{s.jsx=s,s.jsxs=s,s.jsxDEV=s,s.Fragment="template";function u(n){return n&&typeof n=="object"&&n[o]}s.isElement=u,B(u,"isElement");function p(n){if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"){if(n=""+n,n)return s("text",{content:n})}else{if(u(n))return n;if(!F(n))throw new TypeError(`Invalid content: ${n}`)}}s.toElement=p,B(p,"toElement");function k(n){return Array.isArray(n)?n.map(p).filter(t=>t):[p(n)].filter(t=>t)}s.toElementArray=k,B(k,"toElementArray");function w(n,t){return typeof n=="string"?$(n,t):k(n)}s.normalize=w,B(w,"normalize");function A(n,t=false){const r=(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t?r.replace(/"/g,"&quot;"):r}s.escape=A,B(A,"escape");function g(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(t,r)=>r==="38"?t:String.fromCharCode(+r)).replace(/&#x([0-9a-f]+);/gi,(t,r)=>r==="26"?t:String.fromCharCode(parseInt(r,16))).replace(/&(amp|#38|#x26);/g,"&")}s.unescape=g,B(g,"unescape");function h(n,t={}){var a;const r=$(n);return t.caret?t.type&&((a=r[0])==null?void 0:a.type)!==t.type?void 0:r[0]:N(r,t.type||"*")[0]}s.from=h,B(h,"from");const b=/ *([ >+~]) */g;function j(n){return n.split(",").map(t=>{const r=[];t=t.trim();let a,f=" ";for(;a=b.exec(t);)r.push({type:t.slice(0,a.index),combinator:f}),f=a[1],t=t.slice(a.index+a[0].length);return r.push({type:t,combinator:f}),r})}s.parseSelector=j,B(j,"parseSelector");function N(n,t){if(!n||!t)return[];if(typeof n=="string"&&(n=$(n)),typeof t=="string"&&(t=j(t)),!t.length)return[];let r=[];const a=[];for(const[f,l]of n.entries()){const m=[],C=[...t,...r];r=[];let v=false;for(const y of C){const{type:M,combinator:q}=y[0];(M===l.type||M==="*")&&(y.length===1?v=true:[" ",">"].includes(y[1].combinator)?m.push(y.slice(1)):y[1].combinator==="+"?r.push(y.slice(1)):t.push(y.slice(1))),q===" "&&m.push(y)}v&&a.push(n[f]),a.push(...N(l.children,m))}return a}s.select=N,B(N,"select");function L(n,t){if(n=n.trim(),!/^[\w.]+$/.test(n))return O(n,t)??"";let r=t;for(const a of n.split("."))if(r=r[a],F(r))return"";return r??""}s.interpolate=L,B(L,"interpolate");const se=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,ae=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,ie=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,oe=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=\{(?<curly>[^}]+)\})?/g;let Y;(n=>{n[n.OPEN=0]="OPEN",n[n.CLOSE=1]="CLOSE",n[n.EMPTY=2]="EMPTY",n[n.CONTINUE=3]="CONTINUE"})(Y||(Y={}));function $(n,t){const r=[];function a(v){v&&r.push(v)}B(a,"pushText");const f=t?ae:se;let l,m=true;for(;l=f.exec(n);){const v=!l.groups.curly;C(n.slice(0,l.index),m,v),m=v,n=n.slice(l.index+l[0].length);const[y,,,M,q,_e,be]=l;if(!l.groups.comment){if(l.groups.curly){let ue="",fe=2;l.groups.derivative&&(ue=l.groups.derivative.slice(1),fe={"@":2,"#":0,"/":1,":":3}[l.groups.derivative[0]]),r.push({type:"curly",name:ue,position:fe,source:l.groups.curly,extra:l.groups.curly.slice(1+(l.groups.derivative??"").length,-1)});continue}r.push({type:"angle",source:y,name:q||s.Fragment,position:M?1:be?2:0,extra:_e})}}C(n,m,true);function C(v,y,M){v=g(v),y&&(v=v.replace(/^\s*\n\s*/,"")),M&&(v=v.replace(/\s*\n\s*$/,"")),a(v)}return B(C,"parseContent"),V(H(r),t)}s.parse=$,B($,"parse");function H(n){const t=[[{type:"angle",name:s.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function r(...a){const[f,l]=t[0];f.children[l].push(...a)}B(r,"pushToken");for(const a of n){if(typeof a=="string"){r(a);continue}const{name:f,position:l}=a;l===1?t[0][0].name===f&&t.shift():l===3?(t[0][0].children[f]=[],t[0][1]=f):l===0?(r(a),a.children={default:[]},t.unshift([a,"default"])):r(a)}return t[t.length-1][0].children.default}B(H,"foldTokens");function V(n,t){const r=[];for(const a of n)if(typeof a=="string")r.push(s("text",{content:a}));else if(a.type==="angle"){const f={},l=t?oe:ie;let m;for(;m=l.exec(a.extra);){const[,C,v,y=v,M]=m;M?f[C]=L(M,t):F(y)?C.startsWith("no-")?f[C.slice(3)]=false:f[C]=true:f[C]=g(y)}r.push(s(a.name,f,a.children&&V(a.children.default,t)))}else if(!a.name)r.push(...k(L(a.extra,t)));else if(a.name==="if")O(a.extra,t)?r.push(...V(a.children.default,t)):r.push(...V(a.children.else||[],t));else if(a.name==="each"){const[f,l]=a.extra.split(/\s+as\s+/),m=L(f,t);if(!m||!m[Symbol.iterator])continue;for(const C of m)r.push(...V(a.children.default,{...t,[l]:C}))}return r}B(V,"parseTokens");function G(n,t,r){const{type:a,attrs:f,children:l}=n;if(typeof t=="function")return t(n,r);{let m=t[typeof a=="string"?a:""]??t.default??true;return typeof m=="function"&&(m=m(f,l,r)),m}}B(G,"visit");function J(n,t,r){const a=typeof n=="string"?$(n):n,f=[];return a.forEach(l=>{const{type:m,attrs:C,children:v}=l,y=G(l,t,r);y===true?f.push(s(m,C,J(v,t,r))):y!==false&&f.push(...k(y))}),typeof n=="string"?f.join(""):f}s.transform=J,B(J,"transform");async function Z(n,t,r){const a=typeof n=="string"?$(n):n,f=(await Promise.all(a.map(async l=>{const{type:m,attrs:C,children:v}=l,y=await G(l,t,r);return y===true?[s(m,C,await Z(v,t,r))]:y!==false?k(y):[]}))).flat(1);return typeof n=="string"?f.join(""):f}s.transformAsync=Z,B(Z,"transformAsync");function P(n,...t){return(...r)=>{const a=s(n);return t.forEach((f,l)=>{F(r[l])||(a.attrs[f]=r[l])}),r[t.length]&&Object.assign(a.attrs,r[t.length]),a}}B(P,"createFactory"),s.warn=B(()=>{},"warn");function U(n){return(t,...r)=>{let a="base64://";return typeof r[0]=="string"&&(a=`data:${r.shift()};base64,`),T("Buffer",t)?t=a+t.toString("base64"):T("ArrayBuffer",t)?t=a+we(t):ArrayBuffer.isView(t)&&(t=a+we(t.buffer)),t.startsWith("base64://")&&(0,s.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),s(n,{...r[0],src:t})}}B(U,"createAssetFactory"),s.text=P("text","content"),s.at=P("at","id"),s.sharp=P("sharp","id"),s.quote=P("quote","id"),s.image=U("img"),s.img=U("img"),s.video=U("video"),s.audio=U("audio"),s.file=U("file");function le(n,t){return s("i18n",typeof n=="string"?{path:n}:n,t)}s.i18n=le,B(le,"i18n")})(c||(c={})),i.exports=c}});const Ie=Mt(),Nt={private:"私聊模式",guild:"群聊模式",profile:"用户设置"},S=qe("sandbox",1.1,()=>({platform:"sandbox:"+Math.random().toString(36).slice(2),user:"",index:0,messages:{},panelType:"private"})),te=ye(()=>S.value.panelType==="guild"?"#":"@"+S.value.user);$e("sandbox/message",e=>{var i,o;e.platform===S.value.platform&&((i=S.value.messages)[o=e.channel]||(i[o]=[])).push(e)});$e("sandbox/clear",()=>{S.value.messages[te.value]=[]});const me={deleteMessage({messageId:e,channelId:i}){const o=S.value.messages[i];o&&(S.value.messages[i]=o.filter(d=>d.id!==e))},getMessage({messageId:e,channelId:i}){var o;return(o=S.value.messages[i])==null?void 0:o.find(d=>d.id===e)},getChannel({channelId:e,guildId:i}){return{channelId:"#"}},getChannelList({guildId:e}){return{data:{channelId:"#"}}},getGuild({guildId:e}){return{guildId:"#"}},getGuildList(){return{data:{guildId:"#"}}},getGuildMember({guildId:e,userId:i}){return{userId:i,username:i}},getGuildMemberList({guildId:e}){return{data:Object.keys(S.value.messages).filter(o=>o.startsWith("@")).map(o=>{const d=o.slice(1);return{userId:d,username:d}})}}};$e("sandbox/request",({method:e,nonce:i,data:o})=>{var c;const d=(c=me[e])==null?void 0:c.call(me,o);ee("sandbox/response",i,d)});const Lt=["Alice","Bob","Carol","Dave","Eve","Frank","Grace","Hank","Ivy","Jack","Kathy","Lily","Mandy","Nancy","Oscar","Peggy","Quinn","Randy","Sandy","Toby","Uma","Vicky","Wendy","Xander","Yvonne","Zoe"],Ft={class:"chat-message"},zt={class:"avatar"},It={class:"nickname"},Vt={key:0,class:"quote"},Rt={class:"abstract"},Ut=Ae({__name:"message",props:{data:{}},setup(e){const i=Qe("sandbox.message");return(o,d)=>(R(),W("div",Ft,[I("div",zt,ne(o.data.user[0]),1),I("div",It,ne(o.data.user),1),I("div",{class:"message-box",onContextmenu:d[0]||(d[0]=Re(c=>z(i)(c,o.data),["stop"]))},[o.data.quote?(R(),W("blockquote",Vt,[I("span",Rt,[K(z(ze),{content:o.data.quote.content},null,8,["content"])])])):xe("v-if",true),K(z(ze),{content:o.data.content},null,8,["content"])],32)]))}});const Tt=ve(Ut,[["__scopeId","data-v-4057f070"]]),Pt={class:"user-container"},Ht={class:"avatar"},Et={class:"nick"},Kt=["onClick"],Wt={class:"card-header"},Yt=["onClick"],Gt=I("div",null,"点击「添加用户」开始体验",-1),Jt={class:"card-footer"},Zt={key:0,class:"quote"},qt={class:"left"},Ve=10,Qt=Ae({__name:"layout",setup(e){const i=Xe();i.action("sandbox.message.delete",{action:({sandbox:b})=>h(b.message)}),i.action("sandbox.message.quote",{action:({sandbox:b})=>p.value=b.message});const o=Me.object({authority:Me.natural().description("权限等级")}),d=ye(()=>Object.keys(S.value.messages).filter(b=>b.startsWith("@")).map(b=>b.slice(1))),c=ye(()=>Object.fromEntries(d.value.map(b=>[b,{name:b}])));function O(){if(d.value.length>=Ve)return nt.error("可创建的用户数量已达上限。");let b;do b=Lt[S.value.index++],S.value.index%=Ve;while(d.value.includes(b));S.value.user=b,S.value.messages["@"+b]=[],ee("sandbox/set-user",S.value.platform,S.value.user,{})}function _(b){const j=d.value.indexOf(b);delete S.value.messages["@"+b],ee("sandbox/set-user",S.value.platform,S.value.user,null),S.value.user===b&&(S.value.user=d.value[j]||"")}const s=ce(""),u=ce(0),p=ce();function k(b){if(b.key==="ArrowUp"){const j=S.value.messages[te.value].filter(L=>L.user===S.value.user);let N=j.length-u.value;j[N-1]&&(u.value++,s.value=Ie.unescape(j[N-1].content))}else if(b.key==="ArrowDown"){const j=S.value.messages[te.value].filter(L=>L.user===S.value.user);let N=j.length-u.value;j[N+1]?(u.value--,s.value=Ie.unescape(j[N+1].content)):u.value&&(u.value=0,s.value="")}}const w=ce(),A=ce();De(()=>S.value.user,async b=>{b&&(w.value=await ee("sandbox/get-user",S.value.platform,S.value.user),A.value=Ne(w.value))},{immediate:true}),De(A,async b=>{et(b,w.value)||(await ee("sandbox/set-user",S.value.platform,S.value.user,b),w.value=Ne(b))},{deep:true});function g(b){u.value=0,ee("sandbox/send-message",S.value.platform,S.value.user,te.value,b,p.value),p.value=null}async function h(b){await ee("sandbox/delete-message",b.platform,b.user,b.channel,b.id),me.deleteMessage({messageId:b.id,channelId:b.channel})}return(b,j)=>{const N=Q("k-icon"),L=Q("k-tab-group"),se=Q("el-scrollbar"),ae=Q("k-empty"),ie=Q("k-form"),oe=Q("k-content"),Y=Q("k-layout");return R(),pe(Y,{class:"page-sandbox"},{left:X(()=>[I("div",{class:"card-header k-tab-menu-item",onClick:O},"添加用户"),I("div",Pt,[K(se,null,{default:X(()=>[K(L,{data:c.value,modelValue:z(S).user,"onUpdate:modelValue":j[0]||(j[0]=$=>z(S).user=$)},{default:X(({name:$})=>[I("div",Ht,ne($[0]),1),I("div",Et,ne($),1),I("div",{class:"close",onClick:H=>_($)},[K(N,{name:"times-full"})],8,Kt)]),_:1},8,["data","modelValue"])]),_:1})])]),default:X(()=>[I("div",Wt,[(R(true),W(Be,null,Ge(z(Nt),($,H)=>(R(),W("span",{key:H,class:Je(["k-horizontal-tab-item",{active:z(S).panelType===H}]),onClick:V=>z(S).panelType=H},ne($),11,Yt))),128))]),(R(),pe(Ze,null,[d.value.length?z(S).panelType==="profile"?(R(),pe(oe,{key:"profile"+z(te)},{default:X(()=>[w.value?(R(),pe(ie,{key:0,initial:w.value,modelValue:A.value,"onUpdate:modelValue":j[1]||(j[1]=$=>A.value=$),schema:z(o),"show-header":false},null,8,["initial","modelValue","schema"])):xe("v-if",true)]),_:1})):(R(),W(Be,{key:2},[K(z(tt),{data:z(S).messages[z(te)]||[],pinned:""},{default:X($=>[K(Tt,{data:$},null,8,["data"])]),_:1},8,["data"]),I("div",Jt,[p.value?(R(),W("div",Zt,[I("span",qt,"正在回复 @"+ne(p.value.user),1),K(N,{name:"times-full",onClick:j[2]||(j[2]=$=>p.value=null)})])):xe("v-if",true),K(z(At),{modelValue:s.value,"onUpdate:modelValue":j[3]||(j[3]=$=>s.value=$),onSend:g,onKeydown:k,placeholder:"发送消息到沙盒"},null,8,["modelValue"])])],64)):(R(),pe(ae,{key:"empty"},{default:X(()=>[Gt]),_:1}))],1024))]),_:1})}}});const Xt={},en={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},tn=I("path",{fill:"currentColor",d:"M437.2 403.5L319.1 215l.0001-135C319.1 71.16 312.8 64 303.1 64S288 71.16 288 79.1L287.1 215c0 5.973 1.672 11.83 4.826 16.9L347.6 320H100.4l54.79-88.1C158.3 226.8 160 220.1 160 215L160 79.1C160 71.16 152.8 64 144 64S128 71.16 128 79.1L128 215l-117.2 188.5C-18.48 450.6 15.27 512 70.89 512h306.2C432.7 512 466.5 450.5 437.2 403.5zM410.9 460C407.6 466 397.6 480 377.1 480H70.89c-20.51 0-30.48-13.95-33.82-19.95c-7.025-12.63-6.691-27.46 .873-39.65L80.48 352h287l42.55 68.41C417.6 432.6 417.1 447.4 410.9 460zM112 32h224C344.8 32 352 24.84 352 16S344.8 0 336 0h-224C103.2 0 96 7.156 96 16S103.2 32 112 32z"},null,-1),nn=[tn];function rn(e,i){return R(),W("svg",en,nn)}const sn=ve(Xt,[["render",rn]]);rt.register("activity:flask",sn);const un=e=>{e.page({name:"沙盒",path:"/sandbox",icon:"activity:flask",order:300,authority:4,component:Qt}),e.menu("sandbox.message",[{id:".delete",label:"删除消息"},{id:".quote",label:"引用回复"}])};export{un as default};
