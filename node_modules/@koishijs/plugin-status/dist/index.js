import{Universal as y,withProxy as P,useConfig as Z,store as _,router as D,capitalize as B,message as U,icons as E,Schema as A}from"../client.js";import{openBlock as o,createElementBlock as l,defineComponent as S,resolveComponent as N,createElementVNode as r,normalizeStyle as z,unref as i,createVNode as f,withCtx as $,normalizeClass as I,createTextVNode as C,toDisplayString as u,computed as b,createBlock as k,createCommentVNode as O,Fragment as m,renderList as x,inject as F,pushScopeId as Q,popScopeId as q}from"../vue.js";function R(t){switch(t){case y.Status.OFFLINE:return"offline";case y.Status.ONLINE:return"online";case y.Status.CONNECT:return"connect";case y.Status.DISCONNECT:return"disconnect";case y.Status.RECONNECT:return"reconnect"}}const v=(t,e)=>{const s=t.__vccOpts||t;for(const[a,c]of e)s[a]=c;return s},K={},G={class:"status-light"};function J(t,e){return o(),l("span",G)}const j=v(K,[["render",J],["__scopeId","data-v-5269806f"]]),W={class:"bot-view"},X={class:"info"},Y=["title"],tt=["title"],et={class:"truncate cur-frequency"},st={style:{"margin-right":"8px"}},nt=S({__name:"preview",props:{data:{}},setup(t){const e={[y.Status.ONLINE]:"\u8FD0\u884C\u4E2D",[y.Status.OFFLINE]:"\u79BB\u7EBF",[y.Status.CONNECT]:"\u6B63\u5728\u8FDE\u63A5",[y.Status.RECONNECT]:"\u6B63\u5728\u91CD\u8FDE",[y.Status.DISCONNECT]:"\u6B63\u5728\u65AD\u5F00"};return(s,a)=>{const c=N("el-tooltip"),n=N("k-icon");return o(),l("section",W,[r("div",{class:"avatar",style:z({backgroundImage:`url(${i(P)(s.data.user.avatar)})`}),onClick:a[0]||(a[0]=d=>s.$emit("avatar-click"))},[f(c,{content:e[s.data.status],placement:"right"},{default:$(()=>[f(j,{class:I(i(R)(s.data.status))},null,8,["class"])]),_:1},8,["content"])],4),r("div",X,[r("div",{class:"truncate",title:s.data.user.name},[f(n,{name:"robot"}),C(u(s.data.user.name),1)],8,Y),r("div",{class:"truncate",title:s.data.platform},[f(n,{name:"platform"}),C(u(s.data.platform),1)],8,tt),r("div",et,[r("span",st,[f(n,{name:"arrow-up"}),r("span",null,u(s.data.messageSent)+"/min",1)]),r("span",null,[f(n,{name:"arrow-down"}),r("span",null,u(s.data.messageReceived)+"/min",1)])])])])}}});const M=v(nt,[["__scopeId","data-v-af9427ba"]]),ot={key:0,class:"el-popper__empty"},at={class:"count"},ct=S({__name:"index",setup(t){const e=Z(),s=b(()=>{const n={};for(const d of Object.values(_.status.bots)){const p=R(d.status);n[p]=(n[p]||0)+1}return Object.fromEntries(Object.entries(n).sort((d,p)=>d[0].localeCompare(p[0])))}),a=b(()=>Object.values(_.status.bots).reduce((n,d)=>n+d.messageSent,0)),c=b(()=>Object.values(_.status.bots).reduce((n,d)=>n+d.messageReceived,0));return(n,d)=>{const p=N("k-icon"),w=N("k-status");return i(_).status?(o(),k(w,{key:0},{tooltip:$(()=>[Object.values(i(_).status.bots).length?O("v-if",true):(o(),l("span",ot)),(o(true),l(m,null,x(i(_).status.bots,(h,g)=>{var L;return o(),k(M,{key:g,data:h,class:I({"has-link":(L=h.paths)==null?void 0:L.length}),onClick:V=>i(D).push("/plugins/"+h.paths[0].replace(/\./,"/"))},null,8,["data","class","onClick"])}),128))]),default:$(()=>[(o(true),l(m,null,x(s.value,(h,g)=>(o(),l(m,{key:g},[h>(i(e).mergeThreshold??10)?(o(),l(m,{key:0},[f(j,{class:I(g)},null,8,["class"]),r("span",at,"\xD7"+u(h),1)],64)):(o(true),l(m,{key:1},x(Array(h),(L,V)=>(o(),k(j,{key:V,class:I(g)},null,8,["class"]))),128))],64))),128)),f(p,{name:"arrow-up"}),r("span",null,u(a.value)+"/min",1),f(p,{name:"arrow-down"}),r("span",null,u(c.value)+"/min",1)]),_:1})):O("v-if",true)}}});const rt=v(ct,[["__scopeId","data-v-a3e59fe7"]]),lt=t=>{t.slot({type:"status-right",component:rt})},it={class:"load-bar"},_t={class:"title"},ut={class:"body"},dt=S({__name:"load-bar",props:{rate:{},title:{}},setup(t){const e=t;function s(p,w=1){return+(p*100).toFixed(w)+"%"}const a=["used","app","free"],c=b(()=>[e.rate[1]-e.rate[0],e.rate[0],1-e.rate[1]]),n=b(()=>c.value.findIndex(p=>p>=.5)),d=b(()=>`${s(e.rate[0],1)} / ${s(e.rate[1],1)}`);return(p,w)=>(o(),l("div",it,[r("span",_t,u(p.title),1),r("span",ut,[(o(),l(m,null,x(a,(h,g)=>r("span",{key:h,class:I([h,"bar"]),style:z({width:s(c.value[g])})},[g===n.value?(o(),l(m,{key:0},[C(u(d.value),1)],64)):n.value===-1&&c.value[g]>=.2?(o(),l(m,{key:1},[C(u(s(c.value[g])),1)],64)):O("v-if",true)],6)),64))])]))}});const H=v(dt,[["__scopeId","data-v-74e007b8"]]);function T(t,e=3){return(t*100).toFixed(e)+"%"}const pt={class:"load"},mt=S({__name:"index",setup(t){return(e,s)=>{const a=N("k-status");return i(_).status?(o(),k(a,{key:0},{tooltip:$(()=>[r("div",pt,[f(H,{title:"CPU",rate:i(_).status.cpu},null,8,["rate"]),f(H,{title:"\u5185\u5B58",rate:i(_).status.memory},null,8,["rate"])])]),default:$(()=>[C(" CPU: "+u(i(T)(i(_).status.cpu[1],0))+" \u5185\u5B58: "+u(i(T)(i(_).status.memory[1],0)),1)]),_:1})):O("v-if",true)}}});const vt=v(mt,[["__scopeId","data-v-1f71e878"]]),ft=t=>{t.slot({type:"status-right",component:vt})},ht=S({__name:"analytics",setup(t){const e=F("component:analytic-number"),s=b(()=>Object.values(_.status.bots).reduce((c,n)=>c+n.messageReceived,0)/60),a=b(()=>Object.values(_.analytics.messageByDate).slice(-7).reduce((c,n)=>c+n.receive,0)/7/24/60/60);return(c,n)=>(o(),k(i(e),{icon:"analytic:pulse",title:"\u5F53\u524D QPS"},{default:$(()=>[C(u(+s.value.toFixed(2)),1)]),"footer-left":$(()=>[C("\u8FD1\u671F QPS")]),"footer-right":$(()=>[C(u(+a.value.toFixed(2)),1)]),_:1}))}}),gt=t=>(Q("data-v-6634ad0b"),t=t(),q(),t),yt=gt(()=>r("h2",{class:"k-schema-header"}," \u673A\u5668\u4EBA ",-1)),$t={class:"bots-container flex flex-wrap gap-4"},Ct=S({__name:"config",setup(t){const e=F("manager.settings.current"),s=b(()=>{var a;return Object.values(((a=_.status)==null?void 0:a.bots)||{}).filter(c=>{var n;return(n=c.paths)==null?void 0:n.includes(e.value.path)})});return(a,c)=>{var n;return(n=s.value)!=null&&n.length?(o(),l(m,{key:0},[yt,r("div",$t,[(o(true),l(m,null,x(s.value,(d,p)=>(o(),k(M,{key:p,data:d},null,8,["data"]))),128))])],64)):O("v-if",true)}}});const bt=v(Ct,[["__scopeId","data-v-6634ad0b"]]);async function wt(t){try{return navigator.clipboard.writeText(t)}catch{const e=document.createElement("textarea"),s=document.activeElement;e.value=t,e.setAttribute("readonly",""),e.style.contain="strict",e.style.position="absolute",e.style.left="-9999px",e.style.fontSize="12pt";const a=document.getSelection(),c=a?a.rangeCount>0&&a.getRangeAt(0):null;document.body.appendChild(e),e.select(),e.selectionStart=0,e.selectionEnd=t.length,document.execCommand("copy"),document.body.removeChild(e),c&&(a.removeAllRanges(),a.addRange(c)),s&&s.focus()}}const kt={class:"section"},xt={class:"title"},St=S({__name:"envinfo",setup(t){async function e(){const s=Object.entries(_.envinfo).map(([a,c])=>`${B(a)}:
`+Object.entries(c).map(([n,d])=>`    ${n}: ${d}`).join(`
`)).join(`

`);await wt(s),U.success("\u5DF2\u590D\u5236\u73AF\u5883\u4FE1\u606F\uFF01")}return(s,a)=>{const c=N("k-status");return i(_).envinfo?(o(),k(c,{key:0,class:"version",onClick:e},{tooltip:$(()=>[(o(true),l(m,null,x(i(_).envinfo,(n,d)=>(o(),l("div",kt,[r("p",xt,u(i(B)(d))+":",1),(o(true),l(m,null,x(n,(p,w)=>(o(),l("p",{class:"info",key:w},u(w)+": "+u(p),1))),128))]))),256))]),default:$(()=>[C(" Koishi v"+u(i(_).envinfo.koishi.Core)+" ",1)]),_:1})):O("v-if",true)}}});const Nt=v(St,[["__scopeId","data-v-66363001"]]),Ot={},It={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"},Et=r("path",{fill:"currentColor",d:"M6.625 215.5l168-176C179.2 34.7 185.4 32.02 192 32.02s12.84 2.688 17.38 7.438l168 176c9.125 9.594 8.781 24.78-.8125 33.94c-9.5 9.156-24.75 8.812-33.94-.8125L216 115.9V456c0 13.25-10.75 23.1-23.1 23.1S168 469.3 168 456V115.9l-126.6 132.7C32.22 258.2 16.97 258.5 7.438 249.4C-2.156 240.2-2.5 225 6.625 215.5z"},null,-1),Lt=[Et];function jt(t,e){return o(),l("svg",It,Lt)}const Vt=v(Ot,[["render",jt]]),Bt={},At={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512"},Ht=r("path",{fill:"currentColor",d:"M377.4 296.6l-168 176C204.8 477.3 198.6 480 192 480s-12.84-2.688-17.38-7.438l-168-176C-2.5 286.1-2.156 271.8 7.438 262.6c9.5-9.156 24.75-8.812 33.94 .8125L168 396.1V56.02c0-13.25 10.75-24.01 23.1-24.01S216 42.77 216 56.02v340.1l126.6-132.7c9.156-9.625 24.41-9.969 33.94-.8125C386.2 271.8 386.5 286.1 377.4 296.6z"},null,-1),Tt=[Ht];function zt(t,e){return o(),l("svg",At,Tt)}const Ft=v(Bt,[["render",zt]]),Rt={},Mt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Pt=r("path",{fill:"currentColor",d:"M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z"},null,-1),Zt=[Pt];function Dt(t,e){return o(),l("svg",Mt,Zt)}const Ut=v(Rt,[["render",Dt]]),Qt={},qt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"},Kt=r("path",{fill:"currentColor",d:"M640 240C640 248.8 632.8 256 624 256h-133.1l-60 150c-2.625 6.375-8.375 10.25-16 9.1C408 415.5 402.1 410.6 400.5 403.9l-78.75-315l-82 410.3C238.3 506.5 231.9 511.8 224.4 512H224c-7.25 0-13.75-5-15.5-12.12L147.5 256H16C7.201 256 0 248.8 0 240s7.201-15.1 16-15.1H160c7.375 0 13.75 4.993 15.5 12.12l46.75 187l82-410.3C305.8 5.5 312 .25 319.5 0c8.125 .125 14.25 4.875 16 12.12l84 336l45.63-114.1C467.5 228 473.5 224 480 224h144C632.8 224 640 231.2 640 240z"},null,-1),Gt=[Kt];function Jt(t,e){return o(),l("svg",qt,Gt)}const Wt=v(Qt,[["render",Jt]]),Xt={},Yt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"},te=r("path",{fill:"currentColor",d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},null,-1),ee=[te];function se(t,e){return o(),l("svg",Yt,ee)}const ne=v(Xt,[["render",se]]);E.register("arrow-up",Vt);E.register("arrow-down",Ft);E.register("platform",Ut);E.register("analytic:pulse",Wt);E.register("robot",ne);const ce=t=>{t.plugin(lt),t.plugin(ft),t.slot({type:"status-left",component:Nt}),t.slot({type:"analytic-number",component:ht}),t.slot({type:"plugin-details",component:bt,order:-500}),t.settings({id:"status",schema:A.object({mergeThreshold:A.number().default(10).description("\u5F53\u673A\u5668\u4EBA\u7684\u6570\u91CF\u8D85\u8FC7\u8FD9\u4E2A\u503C\u65F6\u5C06\u5408\u5E76\u663E\u793A\u72B6\u6001\u6307\u793A\u706F\u3002")}).description("\u673A\u5668\u4EBA\u8BBE\u7F6E")})};export{ce as default};
