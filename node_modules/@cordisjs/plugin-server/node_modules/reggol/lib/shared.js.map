{
  "version": 3,
  "sources": ["../src/shared.ts"],
  "sourcesContent": ["import { stdout } from 'supports-color'\nimport { Time } from 'cosmokit'\n\nconst c16 = [6, 2, 3, 4, 5, 1]\nconst c256 = [\n  20, 21, 26, 27, 32, 33, 38, 39, 40, 41, 42, 43, 44, 45, 56, 57, 62,\n  63, 68, 69, 74, 75, 76, 77, 78, 79, 80, 81, 92, 93, 98, 99, 112, 113,\n  129, 134, 135, 148, 149, 160, 161, 162, 163, 164, 165, 166, 167, 168,\n  169, 170, 171, 172, 173, 178, 179, 184, 185, 196, 197, 198, 199, 200,\n  201, 202, 203, 204, 205, 206, 207, 208, 209, 214, 215, 220, 221,\n]\n\nfunction isAggregateError(error: any): error is Error & { errors: Error[] } {\n  return error instanceof Error && Array.isArray((error as any)['errors'])\n}\n\nnamespace Logger {\n  export interface LevelConfig {\n    base: number\n    [K: string]: Level\n  }\n\n  export type Level = number | LevelConfig\n  export type Function = (format: any, ...param: any[]) => void\n  export type Type = 'success' | 'error' | 'info' | 'warn' | 'debug'\n  export type Formatter = (value: any, target: Logger.Target, logger: Logger) => any\n\n  export interface LabelStyle {\n    width?: number\n    margin?: number\n    align?: 'left' | 'right'\n  }\n\n  export interface Record {\n    id: number\n    name: string\n    type: Logger.Type\n    level: number\n    content: string\n    timestamp: number\n  }\n\n  export interface Target {\n    /**\n     * - 0: no color support\n     * - 1: 16 color support\n     * - 2: 256 color support\n     * - 3: truecolor support\n     */\n    colors?: false | number\n    showDiff?: boolean\n    showTime?: string\n    label?: LabelStyle\n    maxLength?: number\n    record?(record: Record): void\n    print?(text: string): void\n  }\n}\n\ninterface Logger extends Record<Logger.Type, Logger.Function> {}\n\nclass Logger {\n  // log levels\n  static readonly SILENT = 0\n  static readonly SUCCESS = 1\n  static readonly ERROR = 1\n  static readonly INFO = 2\n  static readonly WARN = 2\n  static readonly DEBUG = 3\n\n  // global config\n  static id = 0\n  static timestamp = 0\n  static targets: Logger.Target[] = [{\n    colors: stdout && stdout.level,\n    print(text) {\n      console.log(text)\n    },\n  }]\n\n  // global registry\n  static formatters: Record<string, Logger.Formatter> = Object.create(null)\n  static instances: Record<string, Logger> = Object.create(null)\n\n  static format(name: string, formatter: Logger.Formatter) {\n    this.formatters[name] = formatter\n  }\n\n  static levels: Logger.LevelConfig = {\n    base: 2,\n  }\n\n  static color(target: Logger.Target, code: number, value: any, decoration = '') {\n    if (!target.colors) return '' + value\n    return `\\u001b[3${code < 8 ? code : '8;5;' + code}${target.colors >= 2 ? decoration : ''}m${value}\\u001b[0m`\n  }\n\n  static code(name: string, target: Logger.Target) {\n    let hash = 0\n    for (let i = 0; i < name.length; i++) {\n      hash = ((hash << 3) - hash) + name.charCodeAt(i)\n      hash |= 0\n    }\n    const colors = !target.colors ? [] : target.colors >= 2 ? c256 : c16\n    return colors[Math.abs(hash) % colors.length]\n  }\n\n  static render(target: Logger.Target, record: Logger.Record) {\n    const prefix = `[${record.type[0].toUpperCase()}]`\n    const space = ' '.repeat(target.label?.margin ?? 1)\n    let indent = 3 + space.length, output = ''\n    if (target.showTime) {\n      indent += target.showTime.length + space.length\n      output += Logger.color(target, 8, Time.template(target.showTime)) + space\n    }\n    const code = Logger.code(record.name, target)\n    const label = Logger.color(target, code, record.name, ';1')\n    const padLength = (target.label?.width ?? 0) + label.length - record.name.length\n    if (target.label?.align === 'right') {\n      output += label.padStart(padLength) + space + prefix + space\n      indent += (target.label.width ?? 0) + space.length\n    } else {\n      output += prefix + space + label.padEnd(padLength) + space\n    }\n    output += record.content.replace(/\\n/g, '\\n' + ' '.repeat(indent))\n    if (target.showDiff) {\n      const diff = Logger.timestamp && record.timestamp - Logger.timestamp\n      output += Logger.color(target, code, ' +' + Time.format(diff))\n    }\n    return output\n  }\n\n  constructor(public name: string) {\n    if (name in Logger.instances) return Logger.instances[name]\n\n    Logger.instances[name] = this\n    this.createMethod('success', Logger.SUCCESS)\n    this.createMethod('error', Logger.ERROR)\n    this.createMethod('info', Logger.INFO)\n    this.createMethod('warn', Logger.WARN)\n    this.createMethod('debug', Logger.DEBUG)\n  }\n\n  extend = (namespace: string) => {\n    return new Logger(`${this.name}:${namespace}`)\n  }\n\n  warning = (format: any, ...args: any[]) => {\n    this.warn(format, ...args)\n  }\n\n  createMethod(type: Logger.Type, level: number) {\n    this[type] = (...args) => {\n      if (args.length === 1 && args[0] instanceof Error) {\n        if (args[0].cause) {\n          this[type](args[0].cause)\n        } else if (isAggregateError(args[0])) {\n          args[0].errors.forEach(error => this[type](error))\n          return\n        }\n      }\n\n      if (this.level < level) return\n      const id = ++Logger.id\n      const timestamp = Date.now()\n      for (const target of Logger.targets) {\n        const content = this.format(target, ...args)\n        const record: Logger.Record = { id, type, level, name: this.name, content, timestamp }\n        if (target.record) {\n          target.record(record)\n        } else {\n          const { print = console.log } = target\n          print(Logger.render(target, record))\n        }\n      }\n      Logger.timestamp = timestamp\n    }\n  }\n\n  private format(target: Logger.Target, ...args: any[]) {\n    if (args[0] instanceof Error) {\n      args[0] = args[0].stack || args[0].message\n      args.unshift('%s')\n    } else if (typeof args[0] !== 'string') {\n      args.unshift('%o')\n    }\n\n    let format: string = args.shift()\n    format = format.replace(/%([a-zA-Z%])/g, (match, char) => {\n      if (match === '%%') return '%'\n      const formatter = Logger.formatters[char]\n      if (typeof formatter === 'function') {\n        const value = args.shift()\n        return formatter(value, target, this)\n      }\n      return match\n    })\n\n    for (let arg of args) {\n      if (typeof arg === 'object' && arg) {\n        arg = Logger.formatters['o'](arg, target, this)\n      }\n      format += ' ' + arg\n    }\n\n    const { maxLength = 10240 } = target\n    return format.split(/\\r?\\n/g).map(line => {\n      return line.slice(0, maxLength) + (line.length > maxLength ? '...' : '')\n    }).join('\\n')\n  }\n\n  get level() {\n    const paths = this.name.split(':')\n    let config: Logger.Level = Logger.levels\n    do {\n      config = config[paths.shift()!] ?? config['base']\n    } while (paths.length && typeof config === 'object')\n    return config as number\n  }\n\n  set level(value) {\n    const paths = this.name.split(':')\n    let config = Logger.levels\n    while (paths.length > 1) {\n      const name = paths.shift()!\n      const value = config[name]\n      if (typeof value === 'object') {\n        config = value\n      } else {\n        config = config[name] = { base: value ?? config.base }\n      }\n    }\n    config[paths[0]] = value\n  }\n}\n\nLogger.format('s', (value) => value)\nLogger.format('d', (value) => +value)\nLogger.format('j', (value) => JSON.stringify(value))\nLogger.format('c', (value, target, logger) => {\n  return Logger.color(target, Logger.code(logger.name, target), value)\n})\nLogger.format('C', (value, target) => {\n  return Logger.color(target, 15, value, ';1')\n})\n\nexport = Logger\n"],
  "mappings": "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",
  "names": ["value"]
}
